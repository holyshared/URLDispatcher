<script type="text/javascript" src="/depender/build?require=URLDispatcher/URLDispatcher.URLEventDispatcher,URLDispatcher/URLDispatcher.Handler"></script>
<script type="text/javascript">
(function(doc){

	window.addEventListener('load', function(){

		var h = new URLDispatcher.Handler(function(){});

		try {
			h.setDispatcher('aa');
			log('assert ng');
		} catch(e){
			log('assert ok');
		}

		try {
			h.setDispatcher(new URLDispatcher.URLEventDispatcher());
			log('assert ok');
		} catch(e){
			log('assert ng');
		}

		var options = {
			paturn: '^/:name',
			conditions: ['\\w+']
		};
		var route = new URLDispatcher.Route(options);

		var h1 = new URLDispatcher.Handler(function(){
			var name = this.getParam('name');
			log( (name == 'foo') ? 'assert ok' : 'assert ng' ); 
		});

		var h2 = new URLDispatcher.Handler(function(){
			var key = this.getParam('key');
			var type = this.getParam('type');

			log( (key == 'foo') ? 'assert ok' : 'assert ng' ); 
			log( (type == 'moo') ? 'assert ok' : 'assert ng' ); 
		});


		var eventHandler = function(){
			var name = this.getParam('name');
			var status = this.getParam('status');
			var page = this.getParam('page');
			log( (name == 'holyshared') ? 'assert ok' : 'assert ng' );
			log( (status == 'sleep') ? 'assert ok' : 'assert ng' );
			log( (page == 100) ? 'assert ok' : 'assert ng' );
		};

		var h3 = {
			preDispatch: eventHandler,
			execute: eventHandler,
			postDispatch: eventHandler
		};

		var dispatcher = new URLDispatcher();
		dispatcher.addRoute('^/:name', h1, ['\\w+']);
		dispatcher.addRoute('^/:key/:type', h2, ['\\w+', '\\w+']);
		dispatcher.addRoute('^/:name/:status/:page', h3, ['\\w+', '\\w+', '\\d+']);

		dispatcher.dispatch('/foo');
		dispatcher.dispatch('/foo/moo');
		dispatcher.dispatch('/holyshared/sleep/100');

		h2.redirect('/foo/moo', {
			value1: 1,
			value2: 2
		});

		dispatcher.removeRoute('^/:name')
			.removeRoute('^/:key/:type');

		log( (!dispatcher.hasRoute('^/:name')) ? 'assert ok' : 'assert ng' ); 
		log( (!dispatcher.hasRoute('^/:key/:type')) ? 'assert ok' : 'assert ng' ); 

	}, false);

}(document));
</script>
