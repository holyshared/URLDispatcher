(function(){var a=this.URLDispatcher=function(){this.initialize.apply(this,arguments)};Object.append(a,{version:"2.1"})}());(function(b){var a=["args","params","resources"];b.Context=new Class({_args:null,_params:null,_resources:null,initialize:function(d){var c=this;a.each(function(f,e){c["_"+f]=d[f]||{}})},getArg:function(c){return this._args[c]||null},getArgs:function(){var c=Array.from(arguments);return c.map(this.getArg,this).associate(c)},getParam:function(c){return this._params[c]||null},getParams:function(){var c=Array.from(arguments);return c.map(this.getParam,this).associate(c)},hasResource:function(c){return(this._resources[c])?true:false},getResource:function(c){if(!this.hasResource(c)){throw new Error("There is no resource "+c+".")}return this._resources[c]},getResources:function(){var c=Array.from(arguments);return c.map(this.getResource,this).associate(c)}});new Type("URLDispatcherContext",b.Context)}(URLDispatcher));(function(a){a.Resource=new Class({_resources:{},addResource:function(b,c){this._resources[b]=c},addResources:function(c){var b=this;Object.each(c,function(e,d){b.addResource(d,e)})},removeResource:function(b){if(!this.hasResource(b)){throw new Error("Resource "+b+" was not found.")}delete this._resources[b];return this},removeResources:function(){Array.each(arguments,this.removeResource,this);return this},hasResource:function(b){return(this._resources[b])?true:false},getResource:function(b){if(!this.hasResource(b)){throw new Error("Resource "+b+" was not found.")}return this._resources[b]},getResources:function(){var b=Array.from(arguments);return b.map(this.getResource,this).associate(b)},getResourceContainer:function(){return this._resources}})}(URLDispatcher));(function(a){a.Route=new Class({_paturn:null,_conditions:[],initialize:function(b){if(!b.paturn){throw new Error("The URL pattern is indispensable.")}for(var c in b){var d=b[c];var e="set"+c.capitalize();this[e](d)}},match:function(e){var f=this._compile();if(!f.test(e)){return false}var d=e.match(f);var c=(Type.isArray(d))?d.shift():e;var g=d.associate(this._toKeys());var b={url:c,paturn:this.getPaturn(),conditions:this.getConditions(),params:g};return b},_compile:function(){var b=this.getPaturn();var c=this._toMap();Object.each(c,function(e,d){b=b.replace(d,"("+e+")")});return new RegExp(b)},_toMap:function(){var c=this.getConditions();var b=this._getElements();return(b&&c)?c.associate(b):{}},_toKeys:function(){var b=this._getElements();return(b)?b.invoke("replace",":",""):[]},_getElements:function(){var b=this.getPaturn();var c=new RegExp("(:\\w+)","g");var d=b.match(c);return d},isValid:function(){var b=this._getElements();var c=this._toMap();return(Object.getLength(c)==b.length)},getPaturn:function(){return this._paturn},setPaturn:function(b){if(!Type.isString(b)){throw new TypeError("Paturn should be a character string.")}this._paturn=b},getConditions:function(){return this._conditions},setConditions:function(b){if(!Type.isArray(b)){throw new TypeError("Conditions should be an array.")}this._conditions=b},assemble:function(b){if(!this.isValid()){throw new Error("Placeholder is not corresponding to the condition. ")}var c=this.getPaturn();var f=this.getConditions();var d=new RegExp("(:\\w+)","g");var g=c.match(d);var e=f.associate(g);Object.each(e,function(j,h){var i=b[h.replace(":","")];if(i.match(new RegExp(j))){c=c.replace(h,i)}else{throw new Error(h+" is not found from the URL pattern.")}});if(c.charAt(0)=="^"){c=c.replace("^","")}return c}});new Type("URLDispatcherRoute",a.Route)}(URLDispatcher));(function(a){a.Router=new Class({_routes:{},initialize:function(b){if(!b){return}this.addRoutes(b)},match:function(c){var b=false;Object.each(this._routes,function(d){var e=d.match(c);if(e){b=e}});return b},hasRoute:function(b){return(this._routes[b])?true:false},addRoute:function(d,e){var c={paturn:d,conditions:e||[]};var b=new URLDispatcher.Route(c);this._routes[d]=b;return this},addRoutes:function(b){if(!Type.isArray(b)){throw new TypeError("Please specify the route by the array.")}var c=this;b.each(function(d,e){c.addRoute(d.paturn,d.conditions)});return this},removeRoute:function(b){if(!this.hasRoute(b)){return false}delete this._routes[b];return this},removeRoutes:function(b){Array.each(arguments,this.removeRoute,this);return this},getRoute:function(b){if(!this.hasRoute(b)){return false}return this._routes[b]},getRoutes:function(){var b=Array.from(arguments);return b.map(this.getRoute,this).associate(b)},getLength:function(){return Object.getLength(this._routes)}})}(URLDispatcher));(function(b){function a(d){var e=null;var c=typeOf(d);if(c=="object"&&Type.isFunction(d.execute)){e=d}else{if(c=="function"){e={execute:d}}else{throw new TypeError("Please specify the function or the object for the event handler.")}}return Object.merge(this,e)}b.Handler=new Class({initialize:function(c){return a.apply(this,[c])},execute:function(c){}});new Type("URLDispatcherHandler",b.Handler)}(URLDispatcher));(function(a){a.HandlerManager=new Class({_handlers:{},initialize:function(b){if(!b){return}this.addHandlers(b)},addHandler:function(b,c){if(!Type.isURLDispatcherHandler(c)){throw new TypeError("The specified event handler is not URLDispatcherHandler.")}this._handlers[b]=c;return this},addHandlers:function(c){var b=this;Object.each(c,function(e,d){b.addHandler(d,e)});return this},removeHandler:function(b){if(!this.hasHandler(b)){throw new Error("There is no specified event handler.")}delete this._handlers[b];return this},removeHandlers:function(){Array.each(arguments,this.removeHandler,this);return this},hasHandler:function(b){return(this._handlers[b])?true:false},getHandler:function(b){if(!this.hasHandler(b)){throw new Error("There is no specified event handler.")}return this._handlers[b]},getHandlers:function(){var b=Array.from(arguments);return b.map(this.getHandler,this).associate(b)},getLength:function(){return Object.getLength(this._handlers)}})}(URLDispatcher));(function(a){Object.append(a,{SUCCESS:0,FAILURE:1});a.URLEventDispatcher=new Class({Implements:[Events,Options,a.Resource],options:{},initialize:function(b){this._router=new a.Router();this._handlers=new a.HandlerManager();this.setOptions(this._prepere(b))},_prepere:function(b){var d=Object.subset(b||{},["routes","resources"]);for(var c in d){var e="add"+c.capitalize();this[e](d[c]);delete b[c]}return b}.protect(),addRoute:function(b,c,e){var d=(!Type.isURLDispatcherHandler(c))?new a.Handler(c):c;d.setDispatcher(this);this._router.addRoute(b,e);this._handlers.addHandler(b,d);return this},addRoutes:function(b){var c=this;b.each(function(d,e){c.addRoute(d.paturn,d.handler,d.conditions)});return this},removeRoute:function(b){this._router.removeRoute(b);this._handlers.removeHandler(b);return this},removeRoutes:function(){Array.each(arguments,this.removeRoute,this);return this},hasRoute:function(b){return this._router.hasRoute(b)},getLength:function(){return this._router.getLength()},dispatch:function(e,d){this.fireEvent("startup");this.fireEvent("routingStart",[e,d]);var b=this._router.match(e);if(!b){return false}this.fireEvent("routingEnd",[b]);var h=b.paturn;var i=this._handlers.getHandler(h);var c=Object.merge(b,{args:d||{},resources:this.getResourceContainer()||{}});var g=new a.Context(c);if(Type.isFunction(i.beforeDispatch)){try{i.beforeDispatch(g)}catch(f){throw f}}if(Type.isFunction(i.execute)){try{i.execute(g)}catch(f){throw f}}if(Type.isFunction(i.afterDispatch)){try{i.afterDispatch(g)}catch(f){throw f}}this.fireEvent("shutdown");return a.SUCCESS}});new Type("URLEventDispatcher",a.URLEventDispatcher);a.Handler.implement({_dispatcher:null,getDispatcher:function(){return this._dispatcher},setDispatcher:function(b){if(!Type.isURLEventDispatcher(b)){throw new TypeError("The specified value is not URLEventDispatcher.")}this._dispatcher=b},redirect:function(c,b){this._dispatcher.dispatch(c,b)}});a.implement(new a.URLEventDispatcher())}(URLDispatcher));