(function(){var c=this.URLDispatcher=function(){};Object.append(c,{version:"2.0"})})();
(function(c){c.Resource=new Class({_resources:{},addResource:function(a,b){this._resources[a]=b},addResources:function(a){var b=this;Object.each(a,function(a,e){b.addResource(e,a)})},removeResource:function(a){if(!this.hasResource(a))throw Error("Resource "+a+" was not found.");delete this._resources[a];return this},removeResources:function(){Array.each(arguments,this.removeResource,this);return this},hasResource:function(a){return this._resources[a]?!0:!1},getResource:function(a){if(!this.hasResource(a))throw Error("Resource "+
a+" was not found.");return this._resources[a]},getResources:function(){var a=Array.from(arguments);return a.map(this.getResource,this).associate(a)}})})(URLDispatcher);
(function(c){c.Route=new Class({_paturn:null,_conditions:[],initialize:function(a){if(!a.paturn)throw Error("The URL pattern is indispensable.");for(var b in a){var d=a[b];this["set"+b.capitalize()](d)}},match:function(a){var b=this.toRegExp();if(!b.test(a))return!1;b=a.match(b);return{url:Type.isArray(b)?b.shift():a,paturn:this.getPaturn(),conditions:this.getConditions(),params:this.getParams(b)}},toRegExp:function(){var a=this.getPaturn(),b=this.getConditions(),d=a.split("/"),e=0;d.each(function(a,
c){if(a.charAt(0)==":"){if(!b[e])throw Error("The corresponding pattern is not found.");d[c]="("+b[e]+")";e++}});return RegExp(d.join("/"))},getParams:function(a){var b=0,d={};this.getPaturn().split("/").each(function(c){c.charAt(0)==":"&&(c=c.replace(":",""),d[c]=a[b++])});return d},getPaturn:function(){return this._paturn},setPaturn:function(a){if(!Type.isString(a))throw new TypeError("Paturn should be a character string.");this._paturn=a},getConditions:function(){return this._conditions},setConditions:function(a){if(!Type.isArray(a))throw new TypeError("Conditions should be an array.");
this._conditions=a},assemble:function(a){var b=this.getPaturn(),d=/:[a-zA-Z]+\/?/;if(d.test(b)&&a)for(var c in a){d=RegExp(":"+c);if(!d.test(b))throw Error(c+" is not found from the URL pattern.");b=b.replace(":"+c,a[c])}b.charAt(0)=="^"&&(b=b.replace("^",""));return b}});new Type("URLDispatcherRoute",c.Route)})(URLDispatcher);
(function(c){c.Router=new Class({_routes:{},initialize:function(a){a&&this.addRoutes(a)},match:function(a){var b=!1;Object.each(this._routes,function(d){(d=d.match(a))&&(b=d)});return b},hasRoute:function(a){return this._routes[a]?!0:!1},addRoute:function(a,b){var d=new URLDispatcher.Route({paturn:a,conditions:b||[]});this._routes[a]=d;return this},addRoutes:function(a){if(!Type.isArray(a))throw new TypeError("Please specify the route by the array.");var b=this;a.each(function(a){b.addRoute(a.paturn,
a.conditions)});return this},removeRoute:function(a){if(!this.hasRoute(a))return!1;delete this._routes[a];return this},removeRoutes:function(){Array.each(arguments,this.removeRoute,this);return this},getRoute:function(a){if(!this.hasRoute(a))return!1;return this._routes[a]},getRoutes:function(){var a=Array.from(arguments);return a.map(this.getRoute,this).associate(a)},getLength:function(){return Object.getLength(this._routes)}})})(URLDispatcher);
(function(c){function a(a){var d=null,d=typeOf(a);if(d=="object"&&Type.isFunction(a.execute))d=a;else if(d=="function")d={execute:a};else throw new TypeError("Please specify the function or the object for the event handler.");return Object.merge(this,d)}c.Handler=new Class({_context:null,_dispatcher:null,initialize:function(b){return a.apply(this,[b])},setContext:function(a){if(!Type.isObject(a))throw new TypeError("The specified value is not object.");this._context=a;return this},getContext:function(){return this._context},
getArg:function(a){return this.getContext().args[a]||null},getArgs:function(){var a=Array.from(arguments);return a.map(this.getArg,this).associate(a)},getParam:function(a){return this.getContext().params[a]||null},getParams:function(){var a=Array.from(arguments);return a.map(this.getParam,this).associate(a)},execute:function(){}});new Type("URLDispatcherHandler",c.Handler)})(URLDispatcher);
(function(c){c.HandlerManager=new Class({_handlers:{},initialize:function(a){a&&this.addHandlers(a)},addHandler:function(a,b){if(!Type.isURLDispatcherHandler(b))throw new TypeError("The specified event handler is not URLDispatcherHandler.");this._handlers[a]=b;return this},addHandlers:function(a){var b=this;Object.each(a,function(a,c){b.addHandler(c,a)});return this},removeHandler:function(a){if(!this.hasHandler(a))throw Error("There is no specified event handler.");delete this._handlers[a];return this},
removeHandlers:function(){Array.each(arguments,this.removeHandler,this);return this},hasHandler:function(a){return this._handlers[a]?!0:!1},getHandler:function(a){if(!this.hasHandler(a))throw Error("There is no specified event handler.");return this._handlers[a]},getHandlers:function(){var a=Array.from(arguments);return a.map(this.getHandler,this).associate(a)},getLength:function(){return Object.getLength(this._handlers)}})})(URLDispatcher);
(function(c){Object.append(c,{SUCCESS:0,FAILURE:1});c.URLEventDispatcher=new Class({Implements:[Events,Options,c.Resource],options:{},initialize:function(a){this.setOptions(this._prepere(a));this._router=new c.Router;this._handlers=new c.HandlerManager},_prepere:function(a){var b=Object.subset(a||{},["routes","resources"]),d;for(d in b)this["add"+d.capitalize()](b[d]),delete a[d];return a}.protect(),addRoute:function(a,b,d){b=!Type.isURLDispatcherHandler(b)?new c.Handler(b):b;b.setDispatcher(this);
this._router.addRoute(a,d);this._handlers.addHandler(a,b);return this},addRoutes:function(a){var b=this;Object.each(a,function(a,c){b.addRoute(c,a.handler,a.conditions)});return this},removeRoute:function(a){this._router.removeRoute(a);this._handlers.removeHandler(a);return this},removeRoutes:function(){Array.each(arguments,this.removeRoute,this);return this},hasRoute:function(a){return this._router.hasRoute(a)},getLength:function(){return this._router.getLength()},dispatch:function(a,b){this.fireEvent("startup");
this.fireEvent("routingStart");var d=this._router.match(a);if(!d)return!1;this.fireEvent("routingEnd");var e=this._handlers.getHandler(d.paturn),d=Object.merge(d,{args:b||{}});e.setContext(d);if(Type.isFunction(e.beforeDispatch))try{e.beforeDispatch()}catch(f){throw f;}if(Type.isFunction(e.execute))try{e.execute()}catch(g){throw g;}if(Type.isFunction(e.afterDispatch))try{e.afterDispatch()}catch(h){throw h;}this.fireEvent("shutdown");return c.SUCCESS}});new Type("URLEventDispatcher",c.URLEventDispatcher);
c.Handler.implement({getDispatcher:function(){return this._dispatcher},setDispatcher:function(a){if(!Type.isURLEventDispatcher(a))throw new TypeError("The specified value is not URLEventDispatcher.");this._dispatcher=a},redirect:function(a,b){this._dispatcher.dispatch(a,b)}});c.Handler.implement({hasResource:function(a){return this.getDispatcher().hasResource(a)},getResource:function(a){return this.getDispatcher().getResource(a)},getResources:function(){var a=Array.from(arguments);return this.getDispatcher().getResources.apply(this,
a)}});c.implement(new c.URLEventDispatcher)})(URLDispatcher);